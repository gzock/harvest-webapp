<div class="container">
  <div class="row">
    <div class="col-12 text-center" *ngIf="selectedPlace">
      <h4> 選択対象: {{ selectedPlace.name }} </h4>
    </div>
    
      <mat-tab-group mat-align-tabs="center" class="col-12 row text-center">
        <mat-tab>
          <ng-template mat-tab-label>
            <button mat-raised-button class="mat-elevation-z6">
              <mat-icon class="material-icons md-dark" color="accent">add</mat-icon>
            </button>
          </ng-template>
          <div class="col-12 row add">
            <div class="col-6 col-md-3">
              <mat-form-field class="add-action-type">
                <mat-select placeholder="タイプ" [(ngModel)]="new.type">
                  <mat-option value="place">場所</mat-option>
                  <mat-option value="target">撮影対象</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-6 col-md-6">
              <mat-form-field class="add-action-name">
                <input matInput placeholder="名称" [(ngModel)]="new.name">
              </mat-form-field>
            </div>
            <div class="col-12 col-md-3">
              <button mat-raised-button class="btn-block mat-elevation-z6 add-action-submit" (click)="onCreate(new.type, new.name, selectedPlace.place_id)">
                作成
              </button>
            </div>
          </div>
        </mat-tab>
      
        <mat-tab>
          <ng-template mat-tab-label>
            <button mat-raised-button class="mat-elevation-z6">
              <mat-icon class="material-icons md-dark" color="accent">edit</mat-icon>
            </button>
          </ng-template>
          <div class="col-12 row add">
            <div class="col-9 col-md-6">
              <mat-form-field class="update-action-name">
                <input matInput [(ngModel)]="new.name">
              </mat-form-field>
            </div>
            <div class="col-3 col-md-3">
              <button mat-raised-button class="btn-block mat-elevation-z6 add-action-submit" (click)="onUpdateName(new.name)">
                編集
              </button>
            </div>
          </div>
        </mat-tab>
      
        <mat-tab>
          <ng-template mat-tab-label>
            <button mat-raised-button class="mat-elevation-z6">
              <mat-icon class="material-icons md-dark" color="accent">clear</mat-icon>
            </button>
          </ng-template>
        </mat-tab>
      
        <mat-tab *ngIf="isTarget">
          <ng-template mat-tab-label>
            <button mat-raised-button class="mat-elevation-z6">
              <mat-icon class="material-icons md-dark" color="accent">photo_camera</mat-icon>
            </button>
          </ng-template>
      
          <div class="col-12 row shot">
            <div class="col-12 col-md-4">
              <mat-form-field class="shot-action-type">
                <mat-select placeholder="タイプ" [(ngModel)]="photo.type" required>
                  <mat-option value="before">施工前</mat-option>
                  <mat-option value="after">施工後</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-6 col-md-4">
              <input type="file" id="camera-input" capture="camera" accept="image/*" (change)="onFileSelected($event)"/>
              <label for="camera-input" class="btn-block mat-raised-button mat-elevation-z6 mat-basic shot-action-submit">
                <mat-icon class="material-icons md-dark" color="accent">photo_camera</mat-icon>
                撮影
              </label>
            </div>
            <div class="col-6 col-md-4">
              <button mat-raised-button class="btn-block mat-elevation-z6 shot-action-upload" (click)="onUpload()" [disabled]="!takenPhoto">
                <mat-icon class="material-icons md-dark" color="accent">cloud_upload</mat-icon>
                アップロード
              </button>
            </div>
            <div class="col-12 text-center photo-canvas">
              <app-photo-canvas *ngIf="takenPhoto" [photoSrc]="takenPhoto" (compressed)="onCompressedPhoto($event)"></app-photo-canvas>
            </div>
          </div>
        </mat-tab>

        <mat-tab *ngIf="isTarget && (selectedTarget.photos.before.length || selectedTarget.photos.after.length)">
          <ng-template mat-tab-label>
            <button mat-raised-button class="mat-elevation-z6" (click)="onGetPhoto('before', 0)">
              <mat-icon class="material-icons md-dark" color="accent">photo_library</mat-icon>
            </button>
          </ng-template>

          <div class="col-12 row shot">
            <div class="col-12 text-center photo-canvas">
              <mat-spinner class="loading" *ngIf="!neededPhoto"></mat-spinner>
              <app-photo-canvas *ngIf="neededPhoto" [photoSrc]="neededPhoto"></app-photo-canvas>
            </div>

            <div class="col-6">
              <button mat-stroked-button color="accent" 
                  matBadge="{{ selectedTarget.photos.before.length }}" matBadgePosition="before" matBadgeColor="accent" 
                  [disabled]="!selectedTarget.photos.before.length && selectedPhotoType != 'before'"
                  class="btn-block" (click)="selectedPhotoType = 'before'; onGetPhoto(selectedPhotoType, photoIndex)"
                  [ngClass]='{"mat-elevation-z6": selectedPhotoType === "before"}'>
                施工前
              </button>
            </div>
            <div class="col-6">
              <button mat-stroked-button color="accent" 
                  matBadge="{{ selectedTarget.photos.after.length }}" matBadgePosition="before" matBadgeColor="accent" 
                  [disabled]="!selectedTarget.photos.after.length"
                  class="btn-block" (click)="selectedPhotoType = 'after'; onGetPhoto(selectedPhotoType, photoIndex)"
                  [ngClass]='{"mat-elevation-z6": selectedPhotoType === "after"}'>
                施工後
              </button>
            </div>

            <hr />

            <div class="col-2">
              <button mat-raised-button class="mat-elevation-z6" 
                  (click)="onGetBackPhoto()" 
                  [disabled]="isPhotoIndexMin()">
                <mat-icon class="material-icons md-dark" color="accent">chevron_left</mat-icon>
              </button>
            </div>
            <div class="col-4">
              <button mat-raised-button color="accent" 
                  class="btn-block" (click)="onAdoptPhoto(selectedPhotoType, photoIndex)"
                  [ngClass]='{"mat-elevation-z6": selectedPhotoType === "before"}'
                  *ngIf='selectedTarget["photos"][selectedPhotoType][photoIndex] !== selectedTarget["photos"]["adopt"][selectedPhotoType]'>
                この写真を採用
              </button>
              <label class="btn btn-block btn-success" 
                  *ngIf='selectedTarget["photos"][selectedPhotoType][photoIndex] === selectedTarget["photos"]["adopt"][selectedPhotoType]'>
                この写真が採用されています
              </label>
            </div>
            <div class="col-4">
              <button mat-raised-button color="warn" 
                  class="btn-block" (click)="selectedPhotoType = 'after'; onDeletePhoto(selectedPhotoType, photoIndex)"
                  [ngClass]='{"mat-elevation-z6": selectedPhotoType === "after"}'>
                この写真を削除
              </button>
            </div>
            <div class="col-2">
              <button mat-raised-button class="mat-elevation-z6" 
                  (click)="onGetNextPhoto()" 
                  [disabled]="isPhotoIndexMax()">
                <mat-icon class="material-icons md-dark" color="accent">chevron_right</mat-icon>
              </button>
            </div>

          </div>

        </mat-tab>
      </mat-tab-group>

  </div>
</div>
