<div class="container">
  <div class="row">
    <div class="col-12 text-center" *ngIf="selectedPlace">
      <h4> 選択対象: {{ selectedPlace.name }} </h4>
    </div>
    
      <mat-tab-group mat-align-tabs="center" class="col-12 row text-center">
        <mat-tab>
          <ng-template mat-tab-label>
            <button mat-raised-button class="mat-elevation-z6">
              <mat-icon class="material-icons md-dark" color="primary">add</mat-icon>
            </button>
          </ng-template>
          <div class="col-12 row add">
            <div class="col-6 col-md-3">
              <mat-form-field class="add-action-type">
                <mat-select placeholder="タイプ" [(ngModel)]="new.type">
                  <mat-option value="place">場所</mat-option>
                  <mat-option value="target">撮影対象</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-6 col-md-6">
              <mat-form-field class="add-action-name">
                <input matInput placeholder="名称" [(ngModel)]="new.name">
              </mat-form-field>
            </div>
            <div class="col-12 col-md-3">
              <button mat-raised-button class="btn-block mat-elevation-z6 add-action-submit" (click)="onCreate(new.type, new.name, selectedPlace.place_id)">
                作成
              </button>
            </div>
          </div>
        </mat-tab>
      
        <mat-tab>
          <ng-template mat-tab-label>
            <button mat-raised-button class="mat-elevation-z6">
              <mat-icon class="material-icons md-dark" color="primary">edit</mat-icon>
            </button>
          </ng-template>
        </mat-tab>
      
        <mat-tab>
          <ng-template mat-tab-label>
            <button mat-raised-button class="mat-elevation-z6">
              <mat-icon class="material-icons md-dark" color="primary">clear</mat-icon>
            </button>
          </ng-template>
        </mat-tab>
      
        <mat-tab *ngIf="isTarget">
          <ng-template mat-tab-label>
            <button mat-raised-button class="mat-elevation-z6">
              <mat-icon class="material-icons md-dark" color="primary">photo_camera</mat-icon>
            </button>
          </ng-template>
      
          <div class="col-12 row shot">
            <div class="col-12 col-md-4">
              <mat-form-field class="add-action-type">
                <mat-select placeholder="タイプ" [(ngModel)]="photo.type" required>
                  <mat-option value="before">施工前</mat-option>
                  <mat-option value="after">施工後</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-6 col-md-4">
              <input type="file" id="camera-input" capture="camera" accept="image/*" (change)="onFileSelected($event)"/>
              <label for="camera-input" class="btn-block mat-raised-button mat-elevation-z6 mat-basic shot-action-submit">
                <mat-icon class="material-icons md-dark align-middle" color="primary">photo_camera</mat-icon>
                撮影
              </label>
            </div>
            <div class="col-6 col-md-4">
              <button mat-raised-button class="btn-block mat-elevation-z6 shot-action-upload" (click)="onUpload()" [disabled]="!takenPhoto">
                <mat-icon class="material-icons md-dark align-middle" color="primary">cloud_upload</mat-icon>
                アップロード
              </button>
            </div>
            <div class="col-12 text-center photo-canvas">
              <app-photo-canvas *ngIf="takenPhoto" [photoSrc]="takenPhoto" (compressed)="onCompressedPhoto($event)"></app-photo-canvas>
            </div>
          </div>
        </mat-tab>

        <mat-tab *ngIf="isTarget && (selectedTarget.photos.before.length || selectedTarget.photos.after.length)">
          <ng-template mat-tab-label>
            <button mat-raised-button class="mat-elevation-z6" (click)="onGetPhoto('before', 0)">
              <mat-icon class="material-icons md-dark" color="primary">photo_library</mat-icon>
            </button>
          </ng-template>

          <div class="col-12 row shot">
            <div class="col-12 text-center photo-canvas">
              <app-photo-canvas *ngIf="neededPhoto" [photoSrc]="neededPhoto"></app-photo-canvas>
            </div>

            <div class="col-2">
              <button mat-raised-button class="mat-elevation-z6" 
                  (click)="onGetBackPhoto()" 
                  [disabled]="isPhotoIndexMin()">
                <mat-icon class="material-icons md-dark" color="primary">chevron_left</mat-icon>
              </button>
            </div>
            <div class="col-4">
              <button mat-stroked-button color="primary" 
                  matBadge="{{ selectedTarget.photos.before.length }}" matBadgePosition="before" matBadgeColor="accent" 
                  [disabled]="!selectedTarget.photos.before.length && selectedPhotoType != 'before'"
                  class="btn-block mat-elevation-z6" (click)="selectedPhotoType = 'before'">
                施工前
              </button>
            </div>
            <div class="col-4">
              <button mat-stroked-button color="primary" 
                  matBadge="{{ selectedTarget.photos.after.length }}" matBadgePosition="before" matBadgeColor="accent" 
                  [disabled]="!selectedTarget.photos.after.length"
                  class="btn-block mat-elevation-z6" (click)="selectedPhotoType = 'after'">
                施工後
              </button>
            </div>
            <div class="col-2">
              <button mat-raised-button class="mat-elevation-z6" 
                  (click)="onGetNextPhoto()" 
                  [disabled]="isPhotoIndexMax()">
                <mat-icon class="material-icons md-dark" color="primary">chevron_right</mat-icon>
              </button>
            </div>

          </div>

        </mat-tab>
      </mat-tab-group>

  </div>
</div>
